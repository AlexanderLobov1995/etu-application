<h1>Создание самоподписанного сертификата</h1>
<p>В наши дни для безопасности сетевых соединений, в том числе аутентификации, используются ssl сертификаты. Одна из программ для создания сертификатов - это OpenSSL. Это утилита командной строки, которая позволяет создавать различные виды сертификатов, например, PKI или HTTPS.</p>
<p>В данной работе мы рассмотрим что такое сертификаты, разберем подробно создание сертификата OpenSSL.</p>
<p>***Перед выполнением данной работы рекомендуется прочитать про сертификаты в справочнике Authorization Guide.***</p>

<h3><b>Самоподписанный сертификат</b> — специальный тип сертификата, подписанный самим его субъектом.</h3>
<p>Технически данный тип ничем не отличается от сертификата, заверенного подписью удостоверяющего центра (УЦ), только вместо передачи на подпись в УЦ пользователь создаёт свою собственную сигнатуру. Проще говоря, создатель сертификата сам является в данном случае УЦ. Все корневые сертификаты доверенных УЦ являются самозаверенными.</p>

<p>В этой инструкции мы будем иметь дело с такими видами ключей:</p>
<ul>
  <li><b>.pem, .crt, .cer</b> - готовый, подписанный центром сертификации сертификат, расширения разные, но означают одно и то же. Если совсем просто, то сертификат, это подписанный открытый ключ, плюс немного информации о вашей компании;</li>
  <li><b>.key</b> - закрытый или открытый ключ;</li>
  <li><b>.csr</b> - запрос на подпись сертификата, в этом файле хранится ваш открытый ключ плюс информация, о компании и домене, которую вы указали.</li>
</ul>
<h2>Указания по выполнению лабораторной работы:</h2>
<ol>
  <li>Создать корневой сертификат.</li>
  <li>Создать сертификат для домена, подписанный корневым сертификатом</li>
  <li>Просмотреть содержимое csr</li>
  <li>Промотруть содержимое сертификата в режиме обычного текста</li>
  <li>Просмотрть закрытый ключ</li>
  <li>Проверить действительно ли сертификат подписан нужным CA:</li>
  <li>Показать результаты преподавателю.</li>
</ol>

<p>Чтобы выпустить сертификат для вашего локального домена, понадобится корневой сертификат. На его основе будут выпускаться все остальные сертификаты. Да, для каждого нового top level домена нужно выпускать свой сертификат. Получить корневой сертификат достаточно просто.</p>
<h3>Сначала сформируем закрытый ключ:</h3>
<p>Чтобы создать закрытый ключ выполните такую команду:</p>
<p class="script-code">
  <b>openssl</b> genrsa -out rootCA.key 2048
</p>
<h3>Затем сам сертификат:</h3>
<p class="script-code">
  <b>openssl</b> req -x509 -new -nodes -key rootCA.key  -sha256 -days 1024 -out rootCA.pem
</p>
<p>
  Нужно будет ввести страну, город, компанию и т.д. В результате получаем два файла: rootCA.key и rootCA.pem
</p>
<p>Теперь перейдем к созданию сертификата подписаный нашим Root.pem</p>
<h3>
  Сгенерируем ключ сертификата и запрос на подпись для нашего домена:
</h3>
<p class="script-code">
  <b>openssl</b> genrsa -out server.key 2048
</p>
<p class="script-code">
  <b>openssl</b> req -new -key server.key -subj "/C=CA/ST=None/L=NB/O=None/CN=localhost" -out server.csr
</p>
<h3>Формируем файл сертификата:</h3>
<p>Для этого нам понадобится вспомогательный файл с настройками. В этот файл мы запишем домены, для которых будет валиден сертификат и некоторые другие настройки. Назовем его <b>v3.ext</b>. Обращаю ваше внимание, что это отдельный файл.</p>
<div class="script-code">
  <div>authorityKeyIdentifier=keyid,issuer</div>
  <div>basicConstraints=CA:FALSE</div>
  <div>keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</div>
  <div>subjectAltName = @alt_names</div>
  <p></p>
  <div>[alt_names]</div>
  <div>DNS.1 = localhost</div>
  <div>DNS.2 = *.localhost</div>
</div>
<h3>И наконец, выпускаем сертификат, подписанный корневым сертификатом:</h3>
<p class="script-code">
  <b>openssl</b> x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 1000 -extfile v3.ext
</p>
<h3>В результате должны получить:</h3>
<ul>
  <li>rootCA.key</li>
  <li>rootCA.pem</li>
  <li>server.key</li>
  <li>server.crt</li>
</ul>
